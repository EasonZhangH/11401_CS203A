# LeetCode Daily 2025/11/04 筆記

## 題目：Find X-Sum of All K-Long Subarrays II (LeetCode 3321)

### 題目描述
- 與 3318 相同，但數據規模更大
- 需要更高效的滑動窗口實現

---

### 觀察
- 使用兩個 set 維護 top x 和 other 元素
- 滑動窗口時動態更新兩個集合
- 維護 top x 元素的總和
- 沒解出來，最後是去看人家的 solution 學習
---

### 程式碼 (C++)

```cpp
class Solution {
public:
    using p = pair<int, int>;
    unordered_map<int, int> mp;
    set<p, greater<p>> top;
    set<p, greater<p>> other;
    long long sum = 0;

    void addValue(int v, int x) {
        int& cnt = mp[v];
        if(cnt > 0) {
            p tmp = {cnt, v};
            auto it = top.find(tmp);
            if(it != top.end()) {
                top.erase(it);
                sum -= 1LL*cnt*v;
            }
            else
                other.erase(tmp);
        }

        top.insert({++cnt, v});
        sum += 1LL*cnt*v;

        if(top.size() > x) {
            auto it = prev(top.end());
            int tmpF = it->first, tmpV = it->second;
            other.insert(*it);
            top.erase(it);
            sum -= 1LL*tmpF*tmpV;
        }
    }

    void deleteValue(int v, int x) {
        int& cnt = mp[v];
        p tmp = {cnt, v};

        auto it = top.find(tmp);
        if(it != top.end()) {
            top.erase(it);
            sum -= 1LL*cnt*v;
        }
        else
            other.erase(tmp);
        
        cnt--;
        if(cnt == 0)
            mp.erase(v);
        else
            other.insert({cnt, v});
            
        if( top.size() < x && !other.empty() ) {
            auto it = other.begin();
            int tmpF = it->first, tmpV = it->second;
            sum += 1LL*tmpF*tmpV;
            top.insert(*it);
            other.erase(it);
        }
    }
    
    vector<long long> findXSum(vector<int>& nums, int k, int x) {
        int n = nums.size();
        int windowSize = n - k + 1;
        vector<long long> ans(windowSize);
        mp.reserve(n);

        for(int i = 0; i < k; i++)
            addValue(nums[i], x);
        ans[0] = sum;
        for(int l = 1, r = k; r < n; l++, r++) {
            deleteValue(nums[l - 1], x);
            addValue(nums[r], x);
            ans[l] = sum;
        } 

        return ans;
    }
};
```
